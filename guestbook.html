<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Now That's What I Call Old! Vol. 40</title>
    <link href="style.css" rel="stylesheet" type="text/css">
</head>

<body>
    <header>
        <div class="white-block"><img src="wordart.png"></div>
        <nav>
            <button><a href="index.html">Homepage</a></button>
            <button><a href="info.html">Info</a></button>
            <button><a href="rsvp.html">RSVP</a></button>
            <button><a href="guestbook.html">Guestbook</a></button>
        </nav>
    </header>
    <main>
        <marquee behavior="scroll" direction="left" scrollamount="10">Please RSVP by June 1, 2025</marquee>
        <div class="white-block">
            <h2 class="green-yellow-text">RSVP here!</h2>
            <form id="guestbookForm">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>
                <br>
                <label for="message">Message:</label>
                <textarea id="message" name="message" required></textarea>
                <br>
                <button type="submit">Sign Guestbook</button>
            </form>

            <h2>Guestbook Entries</h2>
            <div id="entries">
                Loading entries...
            </div>
        </div>
    </main>
    <footer>
        <div class="dancing-baby">
            <div class="tenor-gif-embed" data-postid="22415743" data-share-method="host" data-aspect-ratio="0.728125" data-width="100%"></div>
        </div>
        <div align='center'><a href='https://www.free-website-hit-counter.com'><img src='https://www.free-website-hit-counter.com/zc.php?d=6&id=3854&s=1' border='0' alt='Free Website Hit Counter'></a><br /><small><a href='https://www.free-website-hit-counter.com' title="Free Website Hit Counter">Free website hit counter</a></small></div>
    </footer>
</body>
<script>
    const repoOwner = 'webdevwithdustin';
    const repoName = 'birthday';
    const filePath = 'guestbook.json';
    const token = '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';

    async function fetchEntries() {
        const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`;
        try {
            const response = await fetch(url, {
                headers: {
                    Authorization: `token ${token}`,
                },
            });
            const data = await response.json();
            const content = JSON.parse(atob(data.content));
            const entriesDiv = document.getElementById('entries');
            entriesDiv.innerHTML = content
                .map(entry => `<div><strong>${entry.name}</strong>: ${entry.message}</div>`)
                .join('<hr>');
        } catch (error) {
            console.error('Error fetching entries!', error);
        }
    }

    // Initial fetch
    fetchEntries();

</script>
<script>
    async function addEntry(name, message) {
        const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`;
        try {
            // Fetch existing file content
            const getResponse = await fetch(url, {
                headers: {
                    Authorization: `token ${token}`,
                },
            });
            const fileData = await getResponse.json();
            const existingContent = JSON.parse(atob(fileData.content));

            // Add new entry
            existingContent.push({
                name,
                message
            });

            // Update file content
            const updatedContent = btoa(JSON.stringify(existingContent, null, 2)); // Encode to base64
            const response = await fetch(url, {
                method: 'PUT',
                headers: {
                    Authorization: `token ${token}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: 'Add guestbook entry',
                    content: updatedContent,
                    sha: fileData.sha, // Required to avoid overwriting
                }),
            });

            if (response.ok) {
                alert('Entry added successfully!');
                fetchEntries(); // Refresh entries
            } else {
                alert('Error adding entry.');
            }
        } catch (error) {
            console.error('Error adding entry!', error);
        }
    }

    document.getElementById('guestbookForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('name').value.trim();
        const message = document.getElementById('message').value.trim();
        if (name && message) {
            addEntry(name, message);
        }
    });

</script>
<script type="text/javascript" async src="https://tenor.com/embed.js"></script>

</html>
